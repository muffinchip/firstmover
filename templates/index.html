{% extends "layout.html" %}
{% block title %}FirstMover — Early Adopter Score{% endblock %}
{% block body %}
<style>
  .fm-container{max-width:980px;margin:0 auto;padding:24px}
  .fm-title{font-size:28px;font-weight:700;margin-bottom:4px}
  .fm-sub{color:#555;margin-bottom:24px}
  .fm-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width: 880px){ .fm-grid{grid-template-columns:1fr} }
  .card{background:#fff;border:1px solid #e7e7e7;border-radius:12px;padding:18px}
  .card h2{font-size:18px;margin:0 0 8px 0}
  .btn{display:inline-flex;align-items:center;justify-content:center;
       width:100%;padding:12px 14px;border-radius:10px;border:1px solid #1f6feb;
       background:#1f6feb;color:white;text-decoration:none;font-size:16px;
       font-weight:600;cursor:pointer}
  .btn.secondary{background:#fff;color:#1f6feb}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .platform-list{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
  @media (max-width: 880px){ .platform-list{grid-template-columns:1fr} }
  .select{width:100%;padding:8px 10px;border:1px solid #ddd;border-radius:8px}
  .hint{font-size:12px;color:#666;margin-top:8px}
  .footnote{font-size:12px;color:#666;margin-top:14px}
</style>

<div class="fm-container">
  <div class="fm-title">FirstMover</div>
  <div class="fm-sub">Find out how early you joined the major platforms.</div>

  <div class="fm-grid">

    <!-- Option A -->
    <div class="card">
      <h2>Option A — automatically find verified dates</h2>
      <p>We’ll scan your Gmail for welcome/verify emails to confirm when you joined each platform (read-only).</p>

      <div class="platform-list" id="manual-grid-a">
        {% set platforms = [
          ("facebook","Facebook"), ("twitter","Twitter/X"), ("instagram","Instagram"), ("linkedin","LinkedIn"),
          ("dropbox","Dropbox"), ("openai","OpenAI/ChatGPT"), ("spotify","Spotify"), ("reddit","Reddit"),
          ("amazonprime","Amazon Prime")
        ] %}
        {% for key, label in platforms %}
        <div class="row" data-key="{{key}}">
          <div style="min-width:110px;font-weight:600">{{label}}</div>
          <select class="select" name="{{key}}_join_month" aria-label="{{label}} month">
            <option value="">Month</option>
            {% for m in months %}
              <option value="{{ loop.index }}">{{ m }}</option>
            {% endfor %}
          </select>
          <select class="select" name="{{key}}_join_year" aria-label="{{label}} year">
            <option value="">Year</option>
            {% for y in years %}
              <option value="{{y}}">{{y}}</option>
            {% endfor %}
          </select>
        </div>
        {% endfor %}
      </div>

      <div style="margin-top:12px">
        <button id="btn-google" class="btn">Continue with Google verification</button>
      </div>
      <div class="hint">We only request <b>Gmail read-only</b> to look for welcome/verification emails. You’ll see a ✔︎ “verified” badge for platforms confirmed via email.</div>
    </div>

    <!-- Option B -->
    <div class="card">
      <h2>Option B — manually enter dates</h2>
      <p>Skip verification and just use your best recall. You’ll still get a score (without the verified badge).</p>

      <div class="platform-list" id="manual-grid-b">
        {% for key, label in platforms %}
        <div class="row" data-key="{{key}}">
          <div style="min-width:110px;font-weight:600">{{label}}</div>
          <select class="select" name="{{key}}_join_month" aria-label="{{label}} month">
            <option value="">Month</option>
            {% for m in months %}
              <option value="{{ loop.index }}">{{ m }}</option>
            {% endfor %}
          </select>
          <select class="select" name="{{key}}_join_year" aria-label="{{label}} year">
            <option value="">Year</option>
            {% for y in years %}
              <option value="{{y}}">{{y}}</option>
            {% endfor %}
          </select>
        </div>
        {% endfor %}
      </div>

      <div style="margin-top:12px">
        <button id="btn-manual" class="btn secondary">Continue without verification</button>
      </div>
      <div class="footnote">Look for ✔︎ in results — that means the percentile for that platform is verified from email.</div>
    </div>
  </div>
</div>

<script>
async function collectManual(rootId){
  const root = document.getElementById(rootId);
  const payload = {};
  root.querySelectorAll('[data-key]').forEach(row=>{
    const key = row.getAttribute('data-key');
    const m = row.querySelector(`select[name="${key}_join_month"]`).value;
    const y = row.querySelector(`select[name="${key}_join_year"]`).value;
    if(m && y){ payload[`${key}_join_month`] = m; payload[`${key}_join_year`] = y; }
  });
  if(Object.keys(payload).length){
    await fetch("/save_manual", {
      method:"POST", headers:{"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
  }
}

document.getElementById('btn-google').addEventListener('click', async ()=>{
  await collectManual('manual-grid-a');
  window.location.href = "/login/google";
});

document.getElementById('btn-manual').addEventListener('click', async ()=>{
  await collectManual('manual-grid-b');
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = '/results';
  document.body.appendChild(form);
  form.submit();
});
</script>
{% endblock %}
